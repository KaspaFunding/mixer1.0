<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src http://127.0.0.1:8080 ws://127.0.0.1:17110; font-src 'self'; object-src 'none'; base-uri 'none'">
  <title>Kaspa Mixer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <h1>ðŸ”„ Kaspa Mixer</h1>
      <div class="header-controls">
        <div id="node-status-indicator" class="node-status-indicator">
          <span class="status-dot"></span>
          <span id="node-status-text">Checking...</span>
        </div>
        <button id="node-status-btn" class="btn btn-secondary">Node Details</button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
      <div class="container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="sessions">Mixing Sessions</button>
        <button class="tab-btn" data-tab="create">Create Session</button>
        <button class="tab-btn" data-tab="wallet">Wallet</button>
        <button class="tab-btn" data-tab="pool">Mining Pool</button>
      </div>

      <!-- Sessions Tab -->
      <div id="sessions-tab" class="tab-content active">
        <div class="section-header">
          <h2>Active Sessions</h2>
          <button id="refresh-sessions" class="btn btn-secondary">Refresh</button>
        </div>
        <div id="sessions-list" class="sessions-list">
          <div class="loading">Loading sessions...</div>
        </div>
        <div id="debug-info" class="debug-info hidden">
          <h3>Debug Info</h3>
          <pre id="debug-content"></pre>
        </div>
      </div>

      <!-- Create Session Tab -->
      <div id="create-tab" class="tab-content">
        <h2>Create New Mixing Session</h2>
        <form id="create-session-form" class="create-form">
          <div class="form-group">
            <label>Destinations (up to 10)</label>
            <div id="destinations-container">
              <div class="destination-row">
                <input type="text" placeholder="Kaspa address" class="address-input" required>
                <input type="number" step="0.00000001" min="0.00001" placeholder="Amount (KAS)" class="amount-input" required>
                <button type="button" class="btn btn-danger remove-dest">Remove</button>
              </div>
            </div>
            <button type="button" id="add-destination" class="btn btn-secondary">+ Add Destination</button>
          </div>
          <div class="form-group">
            <label>Total Amount: <span id="total-amount">0.00000000</span> KAS</label>
          </div>
          <button type="submit" class="btn btn-primary">Create Session</button>
        </form>
      </div>

      <!-- Wallet Tab -->
      <div id="wallet-tab" class="tab-content">
        <div id="wallet-not-imported" class="wallet-section">
          <h2>Import Wallet</h2>
          <p>Import your private key to use the built-in wallet</p>
          <form id="import-wallet-form" class="wallet-form">
            <div class="form-group">
              <label>Private Key (Hex)</label>
              <input type="password" id="private-key-input" placeholder="Enter private key" required>
            </div>
            <button type="submit" class="btn btn-primary">Import Wallet</button>
          </form>
        </div>

        <div id="wallet-imported" class="wallet-section hidden">
          <div class="section-header">
            <h2>Wallet</h2>
          </div>
          <div id="wallet-info" class="wallet-info">
            <div class="info-row">
              <span>Address:</span>
              <div class="address-container">
                <span id="wallet-address" class="address-text"></span>
                <button id="copy-wallet-address" class="btn btn-secondary btn-sm">Copy</button>
              </div>
            </div>
          </div>
          <div id="wallet-balance" class="wallet-balance">
            <div class="balance-item">
              <span>Balance:</span>
              <span id="balance-amount" class="balance-value">Loading...</span>
            </div>
            <div>
              <button id="refresh-balance" class="btn btn-secondary" style="margin-right:8px;">Refresh</button>
              <button id="wallet-remove-inline" class="btn btn-danger">Remove Wallet</button>
            </div>
          </div>
          <div class="wallet-send">
            <h3>Send Funds</h3>
            <form id="send-funds-form" class="wallet-form">
              <div class="form-group">
                <label>To Address</label>
                <input type="text" id="send-address" placeholder="Kaspa address" required>
              </div>
              <div class="form-group">
                <label>Amount (KAS)</label>
                <input type="number" step="0.00000001" min="0.00001" id="send-amount" placeholder="0.00" required>
              </div>
              <button type="submit" class="btn btn-primary">Send</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Mining Pool Tab -->
      <div id="pool-tab" class="tab-content">
        <h2>Mining Pool</h2>
        <div class="wallet-section" style="max-width:900px;">
          <div class="sessions-list pool-grid-top" style="margin-top: 0;">
            <div class="session-card pool-card">
              <div class="session-header">
                <div>
                  <div class="session-id">Settings</div>
                </div>
              </div>
              <div class="session-details">
                <div class="form-group">
                  <label>Port</label>
                  <input type="number" id="pool-port" value="7777" min="1" max="65535" />
                </div>
                <div class="form-group">
                  <label>Difficulty</label>
                  <input type="number" id="pool-difficulty" value="1" min="1" step="1" />
                  <div class="helper-text" style="margin-top:6px; color:#666; font-size:0.85rem; line-height:1.35;">
                    <div><strong>ASIC guidance:</strong></div>
                    <div>IceRiver KS0â€“KS0 Pro & Ultra: <code>256â€“1024</code></div>
                    <div>IceRiver KS1/KS2/KS2 Lite/KS7: <code>1024â€“4096</code></div>
                    <div>IceRiver KS3L/KS3M/KS3 Pro: <code>4096â€“16384</code></div>
                    <div>IceRiver KS3/KS5L/KS5M/KS7: <code>16384â€“32768</code></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="session-card pool-card">
              <div class="session-header">
                <div>
                  <div class="session-id">Treasury & Threshold</div>
                </div>
              </div>
              <div class="session-details">
                <div class="form-group">
                  <label>Payment Threshold (KAS)</label>
                  <input type="number" id="pool-threshold-kas" value="10" min="0" step="0.00000001" />
                </div>
                <div class="form-group">
                  <label>Treasury Private Key <small id="pool-key-status" style="color:#666; font-weight:400;">(not configured)</small></label>
                  <div style="display:flex; gap:8px; align-items:center;">
                    <input type="password" id="pool-treasury-key" placeholder="Paste private key (hex)" style="flex:1;" />
                    <button id="pool-save-key" class="btn btn-secondary">Save</button>
                  </div>
                  <div style="margin-top:6px; color:#666; font-size:0.85rem; line-height:1.3;">
                    This key authorizes the pool's treasury to send rewards. Payouts are
                    generated by the pool and transferred to the miner's Kaspa address configured
                    in your mining software. Keep this key secure.
                  </div>
                </div>
              </div>
            </div>

            <div class="session-card pool-card full">
              <div class="session-header">
                <div>
                  <div class="session-id">Controls</div>
                </div>
              </div>
              <div class="session-details">
                <div class="detail-row" style="align-items:center;">
                  <span class="detail-label">Status:</span>
                  <span id="pool-status-text">Stopped</span>
                </div>
                <div style="display:flex; gap:8px;">
                  <button id="pool-start" class="btn btn-primary">Start</button>
                  <button id="pool-stop" class="btn btn-danger">Stop</button>
                </div>
              </div>
            </div>
          </div>
          <div class="sessions-list pool-grid" style="margin-top: 12px;">
            <div class="session-card connect-card">
              <div class="session-header">
                <div>
                  <div class="session-id">Pool Stats</div>
                </div>
              </div>
              <div class="session-details">
                <div class="detail-row"><span class="detail-label">Network:</span><span id="pool-network">-</span></div>
                <div class="detail-row"><span class="detail-label">Miners:</span><span id="pool-miners">0</span></div>
                <div class="detail-row"><span class="detail-label">Workers:</span><span id="pool-workers">0</span></div>
              </div>
            </div>
            <div class="session-card">
              <div class="session-header">
                <div>
                  <div class="session-id">How to Connect</div>
                </div>
              </div>
              <div class="session-details" style="display:flex; flex-direction:column; gap:10px;">
                <div>
                  <div class="detail-label" style="margin-bottom:6px;">Local PC (this machine)</div>
                  <div class="code-box"><code id="pool-connect-local">stratum+tcp://127.0.0.1:7777</code></div>
                </div>
                <div>
                  <div class="detail-label" style="margin-bottom:6px;">LAN miners (replace with your PC IP)</div>
                  <div class="code-box"><code id="pool-connect-lan">stratum+tcp://YOUR_PC_IP:7777</code></div>
                </div>
                <div>
                  <div class="detail-label" style="margin-bottom:6px;">Username (wallet address and optional worker)</div>
                  <div class="code-box"><code>kaspa:&lt;your_payout_address&gt;[.worker]</code></div>
                </div>
                <div>
                  <div class="detail-label" style="margin-bottom:6px;">Password</div>
                  <div class="code-box"><code>x</code></div>
                </div>
                <div style="font-size:0.85rem; color:#666;">
                  Tip: On ASICs, set URL to the LAN value (your PC's IP) and use your Kaspa payout address as the username.
                </div>
              </div>
            </div>
          </div>
          <div class="debug-info" style="margin-top:1rem;">
            <h3>Recent Output</h3>
            <pre id="pool-output"></pre>
          </div>
        </div>
      </div>
      </div>
      
    </main>

    <!-- Status Messages -->
    <div id="status-message" class="status-message hidden"></div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>

